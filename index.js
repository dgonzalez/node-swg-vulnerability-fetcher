const request = require('request')
const fs = require('fs')
const path = require('path')
const os = require('os')
const DecompressZip = require('decompress-zip')
const eos = require('on-stream-end')


const fileName = path.join(os.tmpdir(), 'node-swg.zip')

const file = fs.createWriteStream(fileName)
const httpStream = request.get('https://github.com/nodejs/security-wg/archive/master.zip')
.pipe(file)
  .on('finish', () => {
    file.close()

    const unzipper = new DecompressZip(fileName)

    unzipper.on('error', error => {
      console.log(error)
    })

    unzipper.extract({
      path: 'node-swg-vulnerabilities',
      filter: function (file) {
        return file.parent.indexOf('/vuln/') !== -1 && file.path.endsWith('.json')
      }
    })
  })

eos(httpStream, err => {
  console.log('Done!')
  file.close()
})
